<!DOCTYPE html>
<html lang="en" class="dark">
    <head>
        <script src="https://cdn.tailwindcss.com"></script>
        <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/starter-template/">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

        <!-- Bootstrap core CSS -->
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
        <!-- Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
        <meta name="theme-color" content="#7952b3">
        <title>Live Log for {{service}}</title>
    </head>

    <body class="dark:bg-gray-900">

        <div class="flex items-center py-2 px-3">
            <h1 class="text-3xl text-slate-300">Live Log for {{service}}</h1>
        </div>
        <br>

        <!-- Form for settings -->
        <form id="settings_form">
        <div class="flex items-center py-2 px-3">

            <!-- LOG LEVEL -->
            <div style="display: inline-block; zoom: 1; vertical-align: top;width: fit-content;padding-right:1em;">
                <label for="log_level">Log Level:</label>
            </div>

            <div style="display: inline-block;  vertical-align: top;width: fit-content; padding-right:2em;" >
                        <select id="log_level"  name="log_level" class="form-select" style="width: fit-content">
                            <option value="0" selected>All</option>
                            <option value="10">Debug</option>
                            <option value="20">Info</option>
                            <option value="30">Warning</option>
                            <option value="40">Error</option>
                            <option value="50">Critical</option>
                        </select>
            </div>

            <div style="display: inline-block; zoom: 1; vertical-align: top;width: fit-content;padding-right:1em;">
                <label for="log_level_inc">Include others:</label>
            </div>

            <div class="form-check form-switch form-check-inline">
                <input class="form-check-input" type="checkbox" role="switch" id="log_level_inc" checked/>
            </div>


            <!-- LOG SIZE -->
            <div style="display: inline-block; zoom: 1; vertical-align: top;width: fit-content; padding-right:1em;">
                <label for="log_size">Number of entries:</label>
            </div>

            <div style="display: inline-block; width:fit-content; padding-right:2em;">
                <input type="number" value="20" id="log_size" class="form-control" style="width:80px;">
            </div>

            <!-- SUBMIT -->
            <div style="display: inline-block; width:fit-content; padding-right:1em;">
            <button type="button" class="btn btn-primary btn-sm" style="display: inline-block; background-color: #0d6efd" onclick="send_form()">
                Submit
            </button>
            </div>

        </div>
        </form>

        <div class="flex items-center py-2 px-3">
            <div
                id="logs"
                class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                style="overflow-y: auto;height: 450px;"
            >
            reading logs...
            </div>
        </div>

        <script>
            let loc = window.location, new_uri;
            if (loc.protocol === "https:") {
                new_uri = "wss:";
            } else {
                new_uri = "ws:";
            }
            new_uri += "//" + loc.host;
            new_uri += "/ws/live_log/{{service}}";

            let ws_log = new WebSocket(new_uri);

            ws_log.onmessage = function (event) {
                console.log(event.data);

                let logs = document.getElementById("logs");
                logs.innerHTML = event.data;
            };

            function switch_log_size()
            {
                ws_log.send(JSON.stringify({
                    type: "switch_log_size",
                    value: 1
                }));
            }
            function send_form()
            {

                const log_size = document.getElementById("log_size");
                const log_level = document.getElementById("log_level");
                const log_level_inc = document.getElementById("log_level_inc");

                ws_log.send(JSON.stringify({
                    type: "switch_log_size",
                    value: log_size.value
                }));
                ws_log.send(JSON.stringify({
                    type: "switch_log_level",
                    value: log_level.value
                }));
                ws_log.send(JSON.stringify({
                    type: "switch_log_level_inc",
                    value: log_level_inc.checked
                }));
            }
        </script>
    </body>
</html>